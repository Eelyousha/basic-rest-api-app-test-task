# REST API –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π

> –¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ: –°–æ–∑–¥–∞–Ω–∏–µ REST API –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π, –ó–¥–∞–Ω–∏–π –∏ –î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## –û–ø–∏—Å–∞–Ω–∏–µ

REST API –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
- –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–π –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤–∏–¥–æ–≤ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–¥–æ 3 —É—Ä–æ–≤–Ω–µ–π)
- –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º (—Ä–∞–¥–∏—É—Å –∏ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å)
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ API –∫–ª—é—á
- –î—Ä–µ–≤–æ–≤–∏–¥–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π

## –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- **FastAPI** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **Pydantic** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- **SQLAlchemy** - ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- **Alembic** - —Å–∏—Å—Ç–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–π
- **PostgreSQL** - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Docker** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è

## –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è
- –ù–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –û–û–û "–†–æ–≥–∞ –∏ –ö–æ–ø—ã—Ç–∞")
- –¢–µ–ª–µ—Ñ–æ–Ω—ã (–º–∞—Å—Å–∏–≤: 2-222-222, 3-333-333, 8-923-666-13-13)
- –ó–¥–∞–Ω–∏–µ (—Å–≤—è–∑—å —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∑–¥–∞–Ω–∏–µ–º)
- –î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –≤–∏–¥–∞–º–∏)

### –ó–¥–∞–Ω–∏–µ
- –ê–¥—Ä–µ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä: –≥. –ú–æ—Å–∫–≤–∞, —É–ª. –õ–µ–Ω–∏–Ω–∞ 1, –æ—Ñ–∏—Å 3)
- –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (—à–∏—Ä–æ—Ç–∞ –∏ –¥–æ–ª–≥–æ—Ç–∞)

### –î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ù–∞–∑–≤–∞–Ω–∏–µ
- –î—Ä–µ–≤–æ–≤–∏–¥–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å –¥–æ 3 —É—Ä–æ–≤–Ω–µ–π)
- –ü—Ä–∏–º–µ—Ä –¥–µ—Ä–µ–≤–∞:
  ```
  –ï–¥–∞
  ‚îú‚îÄ‚îÄ –ú—è—Å–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è
  ‚îî‚îÄ‚îÄ –ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è
  –ê–≤—Ç–æ–º–æ–±–∏–ª–∏
  ‚îú‚îÄ‚îÄ –ì—Ä—É–∑–æ–≤—ã–µ
  ‚îî‚îÄ‚îÄ –õ–µ–≥–∫–æ–≤—ã–µ
      ‚îú‚îÄ‚îÄ –ó–∞–ø—á–∞—Å—Ç–∏
      ‚îî‚îÄ‚îÄ –ê–∫—Å–µ—Å—Å—É–∞—Ä—ã
  ```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ (–æ–¥–∏–Ω –∫–æ–º–∞–Ω–¥–∞)

```bash
docker-compose up --build
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ:
- **API**: http://localhost:8000
- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
docker-compose down

# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (–≤–∫–ª—é—á–∞—è –¥–∞–Ω–Ω—ã–µ –ë–î)
docker-compose down -v
```

## –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Ç—Ä–µ–±—É—é—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å API –∫–ª—é—á–æ–º:

```
X-API-Key: your-secret-key
```

–ö–ª—é—á –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ —Ñ–∞–π–ª–µ `docker-compose.yml` (–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `API_KEY`).

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã API

### 1. –°–ø–∏—Å–æ–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –∑–¥–∞–Ω–∏–∏
```http
GET /organizations?building_id=1
```

### 2. –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ –≤–∏–¥—É –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (—Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏)
```http
GET /organizations?activity_id=1
```
**–í–∞–∂–Ω–æ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –¥–æ—á–µ—Ä–Ω–∏–µ –≤–∏–¥—ã –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.
–ù–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–∏—Å–∫ –ø–æ "–ï–¥–∞" –≤–µ—Ä–Ω—ë—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Å "–ú—è—Å–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è" –∏ "–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è".

### 3. –ü–æ–∏—Å–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
```http
GET /organizations?name=–†–æ–≥–∞
```
–ß–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ, —Ä–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π –ø–æ–∏—Å–∫.

### 4. –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫

**–†–∞–¥–∏—É—Å** (–≤ –º–µ—Ç—Ä–∞—Ö –æ—Ç —Ç–æ—á–∫–∏):
```http
GET /organizations?lat=55.7558&lon=37.6173&radius=1000
```

**–ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å** (bounding box):
```http
GET /organizations?lat_min=55.74&lat_max=55.76&lon_min=37.59&lon_max=37.63
```

### 5. –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–¥–∞–Ω–∏–π
```http
GET /buildings
```

### 6. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ ID
```http
GET /organizations/1
```
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é: –∑–¥–∞–Ω–∏–µ, –≤—Å–µ –≤–∏–¥—ã –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, —Ç–µ–ª–µ—Ñ–æ–Ω—ã.

### 7. –°–ø–∏—Å–æ–∫ –≤–∏–¥–æ–≤ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```http
GET /activities
```

**–° –¥—Ä–µ–≤–æ–≤–∏–¥–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π**:
```http
GET /activities?include_tree=true
```

## –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### cURL

```bash
# –í—Å–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
curl -H "X-API-Key: your-secret-key" http://localhost:8000/organizations

# –ü–æ–∏—Å–∫ –ø–æ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π)
curl -H "X-API-Key: your-secret-key" \
  "http://localhost:8000/organizations?activity_id=1"

# –ì–µ–æ-–ø–æ–∏—Å–∫ (—Ä–∞–¥–∏—É—Å 1–∫–º –æ—Ç –ö—Ä–∞—Å–Ω–æ–π –ø–ª–æ—â–∞–¥–∏)
curl -H "X-API-Key: your-secret-key" \
  "http://localhost:8000/organizations?lat=55.7539&lon=37.6208&radius=1000"

# –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
curl -H "X-API-Key: your-secret-key" \
  http://localhost:8000/organizations/1 | jq
```

### Python

```python
import requests

API_KEY = "your-secret-key"
BASE_URL = "http://localhost:8000"
headers = {"X-API-Key": API_KEY}

# –ü–æ–∏—Å–∫ –ø–æ –≤–∏–¥—É –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
response = requests.get(
    f"{BASE_URL}/organizations",
    headers=headers,
    params={"activity_id": 1}
)
organizations = response.json()
```

## Swagger UI (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8000/docs
2. –ù–∞–∂–º–∏—Ç–µ "Authorize" –∏ –≤–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á: `your-secret-key`
3. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤—Å–µ –º–µ—Ç–æ–¥—ã –≤ –±—Ä–∞—É–∑–µ—Ä–µ

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ api/                    # –†–æ—É—Ç—ã API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ organizations.py    # –ú–µ—Ç–æ–¥—ã –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ buildings.py        # –ú–µ—Ç–æ–¥—ã –¥–ª—è –∑–¥–∞–Ω–∏–π
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ activities.py       # –ú–µ—Ç–æ–¥—ã –¥–ª—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ models/                 # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ models.py           # Building, Activity, Organization
‚îÇ   ‚îú‚îÄ‚îÄ schemas/                # Pydantic —Å—Ö–µ–º—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ schemas.py          # –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ core/                   # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.py         # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.py             # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ API –∫–ª—é—á—É
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ geo_utils.py        # –ì–µ–æ-–ø–æ–∏—Å–∫ (Haversine)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config.py           # –ù–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ main.py                 # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ alembic/                    # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ versions/
‚îÇ       ‚îî‚îÄ‚îÄ 001_initial_migration.py
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ seed_data.py            # –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
‚îú‚îÄ‚îÄ pyproject.toml              # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç)
‚îú‚îÄ‚îÄ Dockerfile                  # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ docker-compose.yml          # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è (app + postgres)
‚îî‚îÄ‚îÄ README_RU.md                # –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –°—Ö–µ–º–∞

**buildings** (–∑–¥–∞–Ω–∏—è)
- id (PK)
- address (—Å—Ç—Ä–æ–∫–∞)
- latitude (float)
- longitude (float)

**activities** (–≤–∏–¥—ã –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
- id (PK)
- name (—Å—Ç—Ä–æ–∫–∞, —É–Ω–∏–∫–∞–ª—å–Ω–∞—è)
- parent_id (FK to activities, nullable)
- level (int, –º–∞–∫—Å. 3)

**organizations** (–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏)
- id (PK)
- name (—Å—Ç—Ä–æ–∫–∞)
- building_id (FK to buildings)
- phones (–º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫ PostgreSQL)

**organization_activity** (—Å–≤—è–∑—å –º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º)
- organization_id (FK)
- activity_id (FK)

### –ú–∏–≥—Ä–∞—Ü–∏–∏

–ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

```bash
# –í—Ä—É—á–Ω—É—é (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
alembic upgrade head
```

### –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ:
- **3 –∑–¥–∞–Ω–∏—è** –≤ –ú–æ—Å–∫–≤–µ
- **8 –≤–∏–¥–æ–≤ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** (–∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
- **5 –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π** —Å —Ä–∞–∑–Ω—ã–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏

–ü—Ä–∏–º–µ—Ä –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏:
```json
{
  "name": "–û–û–û –†–æ–≥–∞ –∏ –ö–æ–ø—ã—Ç–∞",
  "phones": ["2-222-222", "3-333-333", "8-923-666-13-13"],
  "building": "–≥. –ú–æ—Å–∫–≤–∞, –ë–ª—é—Ö–µ—Ä–∞, 32/1",
  "activities": ["–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è", "–ú—è—Å–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è"]
}
```

## –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ ‚≠ê

–ü—Ä–∏ –ø–æ–∏—Å–∫–µ –ø–æ –≤–∏–¥—É –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞—é—Ç—Å—è **–≤—Å–µ –¥–æ—á–µ—Ä–Ω–∏–µ** –≤–∏–¥—ã:

```python
# –ú–µ—Ç–æ–¥ –≤ –º–æ–¥–µ–ª–∏ Activity
def get_all_descendants(self):
    descendants = [self.id]
    for child in self.children:
        descendants.extend(child.get_all_descendants())
    return descendants
```

–ü–æ–∏—Å–∫ `activity_id=1` (–ï–¥–∞) ‚Üí –Ω–∞—Ö–æ–¥–∏—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Å:
- –ï–¥–∞ (id=1)
- –ú—è—Å–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è (id=3)
- –ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è (id=4)

### 2. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ (3 —É—Ä–æ–≤–Ω—è) ‚≠ê

–£—Ä–æ–≤–µ–Ω—å –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∏ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î:
- –£—Ä–æ–≤–µ–Ω—å 1: –ï–¥–∞, –ê–≤—Ç–æ–º–æ–±–∏–ª–∏
- –£—Ä–æ–≤–µ–Ω—å 2: –ú—è—Å–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è, –õ–µ–≥–∫–æ–≤—ã–µ
- –£—Ä–æ–≤–µ–Ω—å 3: –ó–∞–ø—á–∞—Å—Ç–∏, –ê–∫—Å–µ—Å—Å—É–∞—Ä—ã

–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–æ–¥–µ–ª–∏.

### 3. –ì–µ–æ-–ø–æ–∏—Å–∫ ‚≠ê

**–§–æ—Ä–º—É–ª–∞ –•–∞–≤–µ—Ä—Å–∏–Ω–∞** –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π –Ω–∞ —Å—Ñ–µ—Ä–µ:

```python
def haversine_distance(lat1, lon1, lat2, lon2) -> float:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –≤ –º–µ—Ç—Ä–∞—Ö"""
    R = 6371000  # –†–∞–¥–∏—É—Å –ó–µ–º–ª–∏
    # ... –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞
    return distance_in_meters
```

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è:
- –ü–æ–∏—Å–∫ –ø–æ —Ä–∞–¥–∏—É—Å—É (–∫—Ä—É–≥)
- –ü–æ–∏—Å–∫ –ø–æ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ (bounding box)

### 4. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ API –∫–ª—é—á ‚≠ê

```python
async def verify_api_key(x_api_key: str = Header(...)):
    if x_api_key != settings.API_KEY:
        raise HTTPException(status_code=403, detail="Invalid API Key")
```

–ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–º endpoint'–∞–º —á–µ—Ä–µ–∑ Dependency Injection.

## –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –¢–ó

### ‚úÖ –°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ –ë–î
- 3 –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (organizations, buildings, activities)
- 1 —Å–≤—è–∑—É—é—â–∞—è —Ç–∞–±–ª–∏—Ü–∞ (organization_activity)
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–≤—è–∑–∏ –∏ –∏–Ω–¥–µ–∫—Å—ã

### ‚úÖ –°–æ–∑–¥–∞–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏
- Alembic –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- –ù–∞—á–∞–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞—ë—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ Docker

### ‚úÖ –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- –°–∫—Ä–∏–ø—Ç `scripts/seed_data.py`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∏–º–µ—Ä–∞–º –∏–∑ –¢–ó

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤—Å–µ –º–µ—Ç–æ–¥—ã API
- [x] –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –∑–¥–∞–Ω–∏–∏
- [x] –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ –≤–∏–¥—É –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (—Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏!)
- [x] –ì–µ–æ-–ø–æ–∏—Å–∫ (—Ä–∞–¥–∏—É—Å + –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫)
- [x] –°–ø–∏—Å–æ–∫ –∑–¥–∞–Ω–∏–π
- [x] –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ ID
- [x] –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
- [x] –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ (3 —É—Ä–æ–≤–Ω—è)
- [x] –°–ø–∏—Å–æ–∫ –≤–∏–¥–æ–≤ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### ‚úÖ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
- `docker-compose up` - –æ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞
- PostgreSQL –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ seed –¥–∞–Ω–Ω—ã—Ö
- Health checks –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏

### ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Swagger UI + ReDoc
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑ –∫–æ–¥–∞
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–±–æ—Ä–∫–∏
–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `pyproject.toml` (PEP 517/518/621) –≤–º–µ—Å—Ç–æ —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ `requirements.txt`:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -e .

# –° –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (black, ruff, mypy, pytest)
pip install -e ".[dev]"
```

### Makefile –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞

```bash
make help         # –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥
make build        # –°–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑—ã
make up           # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
make logs         # –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
make test         # –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã (unit + integration)
make test-unit    # –ó–∞–ø—É—Å—Ç–∏—Ç—å unit —Ç–µ—Å—Ç—ã (pytest)
make test-api     # –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (bash)
make clean        # –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞

# –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
make install-dev  # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
make format       # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ (black)
make lint         # –õ–∏–Ω—Ç–∏–Ω–≥ (ruff)
make check-types  # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ (mypy)
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ üß™

–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤:

**Unit —Ç–µ—Å—Ç—ã (pytest):**
- 87+ —Ç–µ—Å—Ç–æ–≤ –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ API endpoints
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –≥–µ–æ-–ø–æ–∏—Å–∫–∞, –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –ù–µ —Ç—Ä–µ–±—É—é—Ç –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç in-memory SQLite

**Integration —Ç–µ—Å—Ç—ã (bash):**
- End-to-end —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω–æ–π PostgreSQL
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö endpoints —á–µ—Ä–µ–∑ HTTP

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å pytest
make install-dev

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
make test

# –¢–æ–ª—å–∫–æ unit —Ç–µ—Å—Ç—ã
make test-unit

# –¢–æ–ª—å–∫–æ integration —Ç–µ—Å—Ç—ã (—Ç—Ä–µ–±—É—é—Ç –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤)
make up
make test-api
```

–ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º. [TESTING.md](TESTING.md)

## –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (–±–µ–∑ Docker)

1. –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:
```bash
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pip install -e ".[dev]"
```

3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ PostgreSQL –∏ —Å–æ–∑–¥–∞–π—Ç–µ –ë–î `organizations`

4. –°–æ–∑–¥–∞–π—Ç–µ `.env`:
```env
DATABASE_URL=postgresql://user:password@localhost:5432/organizations
API_KEY=your-secret-key
```

5. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏:
```bash
alembic upgrade head
```

6. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:
```bash
python scripts/seed_data.py
```

7. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:
```bash
uvicorn app.main:app --reload
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã
docker-compose up -d

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã
./test_api.sh
```

### –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8000/docs
2. Authorize ‚Üí –≤–≤–µ–¥–∏—Ç–µ `your-secret-key`
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∫–∞–∂–¥—ã–π endpoint:
   - ‚úÖ GET /buildings
   - ‚úÖ GET /activities (flat & tree)
   - ‚úÖ GET /organizations (–≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã)
   - ‚úÖ GET /organizations/{id}

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–ò–Ω–¥–µ–∫—Å—ã** –Ω–∞ –≤—Å–µ—Ö –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–∞—Ö
- **Eager loading** –¥–ª—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–∏–∑–±–µ–≥–∞–µ–º N+1)
- **Connection pooling** —á–µ—Ä–µ–∑ SQLAlchemy
- **Efficient queries** —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- API –∫–ª—é—á –¥–ª—è –≤—Å–µ—Ö endpoint'–æ–≤
- –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (–∑–∞—â–∏—Ç–∞ –æ—Ç SQL injection)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Pydantic
- CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [README.md](README.md) - –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (–∞–Ω–≥–ª.)
- [QUICK_START.md](QUICK_START.md) - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- [EXAMPLES.md](EXAMPLES.md) - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API
- [TESTING.md](TESTING.md) - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
- [IMPLEMENTATION.md](IMPLEMENTATION.md) - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
- [MIGRATION_TO_PYPROJECT.md](MIGRATION_TO_PYPROJECT.md) - –û —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ —Å–±–æ—Ä–∫–∏

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –í–µ—Ä—Å–∏–∏
- Python 3.11
- FastAPI 0.109.0
- SQLAlchemy 2.0.25
- PostgreSQL 15

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∫–æ–¥–∞
- –¢–∏–ø–∏–∑–∞—Ü–∏—è (type hints)
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ endpoint'—ã
- Pydantic V2 –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- SQLAlchemy 2.0 (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å)

## Troubleshooting

**–ü–æ—Ä—Ç 8000 –∑–∞–Ω—è—Ç?**
```yaml
# –ò–∑–º–µ–Ω–∏—Ç–µ –≤ docker-compose.yml
ports:
  - "8001:8000"
```

**–ù—É–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –ë–î?**
```bash
docker-compose down -v
docker-compose up --build
```

**–ü—Ä–æ–±–ª–µ–º—ã —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏?**
```bash
docker-compose exec app alembic upgrade head
```

**–ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ?**
```bash
docker-compose exec app python scripts/seed_data.py
```

## –õ–∏—Ü–µ–Ω–∑–∏—è

–£–∫–∞–∑–∞–Ω–∞ –≤ —Ñ–∞–π–ª–µ [LICENSE](LICENSE)

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

–í–æ–ø—Ä–æ—Å—ã –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ Issues –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¢–ó –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
**–í–µ—Ä—Å–∏—è**: 1.0.0
**–î–∞—Ç–∞**: 2026-01-15
